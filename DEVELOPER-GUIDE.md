# Intro
This guide is designed for users familiar with Helm charts and Kubernetes.
## Installation Components

### Installer package 
This component is responsible for managing the installation process and is part of this repository.

### Leap Cli
A command-line interface (CLI) that utilizes the installer package for managing installations.

### Helm charts
Stored in this repository's `charts` directory, these define the Kubernetes YAML configurations. Helm charts are released through the `helm-release` workflow.

#### TensorLeap Chart
Includes all YAML configurations necessary for our application.

#### TensorLeap-Infra Chart
Contains specific charts that need to be installed prior to the TensorLeap chart, usually CRDs (e.g., Elastic Operator).


### Installation manifest
A YAML file capturing a snapshot of the installation, including images and tags, Helm chart version, and various version details like schema, installer version, and appVersion. The installation process adheres to this manifest's specifications, which is generated by the `create manifest` workflow.

### Image list
A document detailing the list of images in use, generated either by the `update-images` workflow or manually by `make update-images`.

## Installation Process
The installation process we utilize k3d to create a local cluster and a Docker registry. Every installation begins with an installation manifest

# Debugging Guide

## Debugging Helm Charts
To debug Helm charts, you can append the `--local` flag to any installation command from the root of this repository. This flag utilizes the image list to rebuild the Helm charts and dynamically generates an installation manifest. It's important to execute `make build-helm` before employing the `--local` flag for accurate results.

## Debugging the Installer
For debugging changes in the installer code, execute the following command at the root of the repository: `go run . install --local`. This enables direct testing of modifications to the installer's functionality.

# Update guide

## Update helm chart
Typically, updates are made to the images by executing the `Update images` workflow. This workflow updates the images and increments the version of the TensorLeap Helm chart if there are changes to the images. Any changes on the master branch trigger the `helm release` and `create manifest` workflows. However, there are occasions when we modify the existing charts or add new ones. If these changes necessitate a cluster reinstallation, you should update the minor version of the Tensorleap chart version

## Updating the Installer (Go Package)

To update the Go code for the installer, follow these steps:

1. **Update the Installer Version**: Modify the version information in the `pkg/version/version.go` file to reflect the new version of the installer.
2. **Tag the Version on GitHub**: Create a new tag in the GitHub repository that matches the updated version name from `version.go`. This helps in tracking versions and changes.
3. **Version Number Increment**: If the update necessitates users to upgrade their CLI, increment the minor version number of the installer. This indicates a non-breaking but significant change.
4. **Update the `leap-cli` Repository**:
   - Increment the version in the `leap-cli` repository to match the new version of the installer.
   - Run `go mod tidy` to clean the module by adding missing and removing unused modules.
5. **Create a New `leap-cli` Version**: After merging the updated code into the main branch, finalize the update by creating a new tag in the `leap-cli` repository. This new tag should reflect the updated version, signaling a new release of the CLI.

These steps ensure that the Go package is correctly updated and that the corresponding CLI tool reflects these changes, maintaining consistency across your development ecosystem.

# Installer Upgrade Mechanism
Upgrades can involve:

1. Updating the Helm chart
2. Reinstalling the cluster
3. Upgrading the CLI

## Updating helm chart
This is the standard upgrade procedure and is done when a cluster reinstallation is not necessary.

## Reinstall cluster
A cluster reinstallation is required when changes affect components like PVC. 

The installer checks for:
1. the `tensorleap` chart has minor change from the previous
2. ths `tensorleap-infra` chart version change
3. the `appVersion` on manifest is changed
4. the `schemaVersion` on manifest is changed

## Upgrade CLI
CLI upgrades are necessary when there are changes in the installer (Go code) that require a reinstallation. The installer compares the installed CLI version against the installer version specified in the manifest.


